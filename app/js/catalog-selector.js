!function(a,b,c){function d(a){this.option=a=$.extend({},d.defaultOption,a);var b=this.container=$(a.container),c=this.selector=a.appendHtml?$(d.html).appendTo(b):b.find(".selectorBar");this.view=$(a.view),this.row=c.find(".selector-row").empty(),this.cover=c.find("#selector-cover"),this.selected=[],this.showSelector=$.proxy(this,"showSelector"),this.hideSelector=$.proxy(this,"hideSelector"),this.init(),this.initEvent()}d.prototype={selected:null,currentPage:0,initData:!1,init:function(){var a=this.selector,b=this.option;a.find(".selector-title").text(b.title),a.find(".selector-row").css("width",b.cols*b.colsWidth-10),b.pop&&a.css({display:"none",position:"absolute"})},initEvent:function(){var a=this.view,b=this.selector,c=this.option;c.pop?a.click(this.showSelector):this.loadColumn(null),b.click(function(){return!1}).delegate("a.selector-option","click",$.proxy(this,"onOptionClick")).delegate("a.pagin","click",$.proxy(this,"onPaginationButtonClick")).delegate("button.search","click",$.proxy(this,"onSearch"))},showSelector:function(){setTimeout($.proxy(function(){var a=this.view,b=a.offset(),d=this.selector,e=a.outerHeight();this.selector.show().css({left:Math.max(Math.min(b.left,c.clientWidth-d.outerWidth()),0),top:b.top+e+5}),$(c).one("click",this.hideSelector),this.initData||this.loadColumn(null)},this),0)},hideSelector:function(a){this.selector.hide()},onOptionClick:function(a){var b=$(a.currentTarget),c=+b.data("index"),d=b.parents(".selector-col:first"),e=d.data("dataArr"),f=e[c],g=d.prevAll().length,h=this.selected,i=h[g],j=this.option;if(i){if(i[0]===b[0])return;i.removeClass("active"),h.splice(g+1),d.nextAll().remove()}h[g]=b.addClass("active"),b.hasClass("haschild")&&this.loadColumn(f,b),this.refreshViewBar(),this.refreshPaginButtons(),$.isFunction(j.change)&&j.change(this,f)},refreshViewBar:function(){for(var a=this.selected,b="",c="",d=0,e=a.length;e>d;d++)b&&(b+='<span class="catalog-icon">&gt;</span>',c+=" > "),b+="<span>"+a[d].text()+"</span>",c+=a[d].text();this.view.html(b).attr("title",c)},refreshPaginButtons:function(){var a=this.currentPage,b=this.row.children(),c=this.selector,d=this.option;c.find("a.prev").toggleClass("disable",0>=a),c.find("a.next").toggleClass("disable",a+d.cols>=b.length)},onPaginationButtonClick:function(a){var b=$(a.currentTarget);if(!b.hasClass("disable")){var c=this.currentPage;b.hasClass("prev")?c--:c++,this.setColumn(c,0)}},setColumn:function(a,b){b||(b=0);var c=this.row,d=c.children(),e=d.eq(a);if(e.length){var f=this.option,g=-(a-b)*f.colsWidth;c.children(":first").animate({"margin-left":g},500,"linear"),this.currentPage=a-b,this.refreshPaginButtons()}},addColumn:function(a,b){for(var c=this.option,d=c.adapter,e="",f=0,g=a.length;g>f;f++){var h=d(a[f]);e+='<a href="javascript:;" data-index="'+f+'" class="selector-option'+(h.hasChild?" haschild":"")+'">'+h.text+"</a>"}e='<div class="selector-col"><div class="input-group"><input type="text" placeholder="搜索" class="form-control"><span class="input-group-btn"><button type="button" class="btn btn-default search">搜索</button></span></div>'+e+"</div>";var i=$(e).data("dataArr",a).find("input").keyup($.proxy(this,"onSearchInputKeyup")).end();return index=this.row.append(i).children().length-1,b!==!1&&this.setColumn(index,Math.min(c.cols-1,index)),i},loadColumn:function(a,b){this.initData=!0,this.loadData(a,function(a){return a&&a.length?void this.addColumn(a):void(b&&b.removeClass("haschild"))})},loadData:function(a,b){var c=this.option,d=c.provider;$.isFunction(d)&&(this.showCover(),d(a,$.proxy(function(a){this.hideCover(),b.call(this,a)},this)))},onSearch:function(a){var b=$(a.currentTarget||a.target),c=b.parents(".selector-col:first"),d=c.find("input"),e=$.trim(d.val()),f=d.data("keyword");f&&c.children("a.hidden").removeClass("hidden"),d.data("keyword",e),e&&c.children("a:not(.active):not(:contains('"+e+"'))").addClass("hidden")},getValue:function(){for(var a=this.selected,b=[],c=0;c<a.length;c++){var d=a[c],e=d.parents(".selector-col:first"),f=+d.data("index"),g=e.data("dataArr"),h=g[f];h&&b.push(h)}return b},onSearchInputKeyup:function(a){13==(a.keyCode||a.charCode)&&this.onSearch(a)},reset:function(a){var b=this.row,c=this.view,d=this.option;b.empty(),c.html('<span class="select-view-title">'+d.viewTitle+"</span>"),this.currentPage=0,this.selected.length=0,this.initData=!1,a!==!1&&!d.pop&&this.loadColumn(null)},showCover:function(){var a=this.selector,b=this.cover;b.css({width:a.outerWidth(),height:a.outerHeight()}).show()},hideCover:function(){var a=this.cover;a.stop(!0,!0).hide()},setData:function(a){this.reset(!1);var b=a.parentCat,c=[],d=$.proxy(function(){this.loadData(b,function(e){return e&&e.length?(e.checked=a,c.push(e),b?(b=b.parentCat||null,a=a.parentCat,void d()):void f.call(this)):void f.call(this)})},this),e=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c].catId==b)return c;return-1},f=function(){for(var a=this.option,b=null;b=c.pop();){var d=this.addColumn(b),f=b.checked;if(f){var g=e(b,f.catId);if(g>=0){var h=d.children("a").eq(g);h.addClass("active"),this.selected.push(h)}}}this.refreshViewBar(),this.refreshPaginButtons(),$.isFunction(a.change)&&a.change(this,data)};d()}},d.defaultOption={cols:2,colsWidth:260,colsHeight:300,title:"选择",viewTitle:"点击选择",view:null,pop:!0,appendHtml:!0,container:document.body,provider:null,adapter:function(a){return a},change:null},d.html='<div class="selectorBar"><div class="panel panel-default"><div class="panel-heading"><a href="javascript:;" class="pagin prev disable"><span class="glyphicon glyphicon-arrow-left"></span></a><span class="selector-title">选择</span><a href="javascript:;" class="pagin next disable"><span class="glyphicon glyphicon-arrow-right"></span></a></div><div class="panel-body"><div class="selector-row"></div></div></div><div class="selector-cover" id="selector-cover"></div>',window.CatalogSelector=d}(window,document,document.body);
/* sm0king 最后修改于：2015-07-07 */
