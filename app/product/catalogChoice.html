<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width"/>
    <title>面板        </title>
    <link rel="stylesheet" href="../plugs/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../css/font-awesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../plugs/datetimepicker/bootstrap-datetimepicker.min.css"/>
    <link rel="stylesheet" href="../css/main.css"/>
    <link rel="stylesheet" href="../js/metisMenu/metisMenu.min.css"/>
    <link rel="stylesheet" href="../css/foot.css"/>
    <link rel="stylesheet" href="../css/sb-admin-2.css"/><!--[if lt IE 9]>
    <script src="../plugs/html5shiv.min.js"></script>
    <script src="../plugs/respond.min.js"></script><![endif]-->
    <link rel="stylesheet" href="../css/product.css"/>
    <link rel="stylesheet" href="../css/catalog-selector.css"/>
  </head>
  <body>
    <div id="wrapper">
      <nav role="navigation" style="margin-bottom: 0" class="navbar navbar-default navbar-static-top">
        <div class="navbar-header">
          <button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
          <h2 class="dashboard-title"><span>万物</span></h2>
          <h4 class="dashboard-subtitle"><img src="..//img/dot.png"/>供应商平台</h4>
        </div>
        <div class="dashboard-top-line"><span>
             
            客服热线<span class="navbar-phone">028-88888888</span></span><span class="separate"></span><a href="javascript:;">帮助中心</a><span class="separate"></span><a href="javascript:;">趣玩</a><span class="separate"></span><a href="javascript:;">退出</a></div>
        <div role="navigation" class="navbar-default sidebar">
          <div class="sidebar-nav navbar-collapse">
            <ul id="side-menu" class="nav in">                           
              <li ui-sref-active="active"><a href="../home.html">首页</a></li>
              <li href="#order_manage" data-toggle="collapse" class="navbar-group-title">订单管理
                <li id="order_manage" class="collapse">
                  <ul>
                    <li id="order_manage" class="collapse in"><a href="../order/index.html">我的订单</a></li>
                  </ul>
                </li>
              </li>
              <li href="#product_manage" data-toggle="collapse" class="navbar-group-title">商品管理</li>
              <li id="product_manage" class="collapse">
                <ul>                                       
                  <li ui-sref-active="active"><a href="../product/index.html">商品列表</a></li>
                  <li ui-sref-active="active"><a href="../product/catalogChoice.html">单件商品添加</a></li>
                  <li ui-sref-active="active"><a href="../product/batch.html">批量导入商品</a></li>
                  <li ui-sref-active="active"><a href="../Brand/index.html">品牌列表</a></li>
                </ul>
              </li>
              <li href="#retailer_manage" data-toggle="collapse" class="navbar-group-title">分销商管理</li>
              <li id="retailer_manage" class="collapse">
                <ul>
                  <li ui-sref-active="active"><a href="../distributor/index.html">分销商列表</a></li>
                </ul>
              </li>
              <li href="#capital_manage" data-toggle="collapse" class="navbar-group-title">财务管理</li>
              <li id="capital_manage" class="collapse">
                <ul>
                  <li ui-sref-active="active"><a href="../capital/index.html">我的账户</a></li>
                  <li ui-sref-active="active"><a href="../capital/record.html">交易记录</a></li>
                </ul>
              </li>
              <li href="#baseinfo_manage" data-toggle="collapse" class="navbar-group-title">基本信息维护</li>
              <li id="baseinfo_manage" class="collapse">
                <ul>
                  <li ui-sref-active="active"><a href="../info/basicinfo.html">完善认证信息    </a></li>
                  <li ui-sref-active="active"><a href="../info/freight.html">运费设置</a></li>
                  <li ui-sref-active="active"><a href="../info/paymessage.html">支付信息设置</a></li>
                  <li ui-sref-active="active"><a href="../info/changepwd.html">修改密码                  </a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <div id="page-wrapper"><!--[if lt IE 9]>
        <div class="M-upBrowser">
          <p class="upBrowser">检测到您的浏览器存在兼容性问题，请您使用<a href="http://browsehappy.com/" target="_blank">万物推荐浏览器</a></p>
        </div><![endif]-->
        <div class="product product-catalog">
          <form class="form-inline">
            <div class="form-group">
              <input type="text" placeholder="输入产品关键字，我们为您推荐类目" id="input-groom" class="form-control"/>
            </div>
            <div class="form-group">
              <button type="button" id="btn-search" class="btn btn-blue btn-search">查询</button>
            </div>
          </form>
          <div id="selector">
            <div id="selector-container"></div>
            <div class="status-bar alert alert-warning">
              <p><span>您当前选择的类目：</span><span id="choice"></span></p>
              <p id="search"><span>请选择类目</span>
                <ul id="searchChoice" class="searchChoice"></ul>
              </p>
              <p>
                <sapn>类目说明：</sapn><span id="catalog-explain"></span>
              </p>
            </div>
          </div>
          <div class="foot-bar">
            <button type="button" id="btn-doNext" class="btn btn-blue">下一步，填写商品详情<span class="glyphicon glyphicon-arrow-right"></span></button>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
    <p><a href="javascript:void(0);">服务协议</a>| <a href="javascript:void(0);">联系我们</a></p>
    <p class="comp">Copyright &copy; 2015 万物wanwu.com版权所有 京ICP备09017905号 </p>
    </div>
    <script type="text/javascript" src="../plugs/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../plugs/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../plugs/datetimepicker/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="../plugs/datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script>
    <script type="text/javascript" src="../js/metisMenu/metisMenu.min.js"></script>
    <script type="text/javascript" src="../js/sb-admin-2.js"></script>
    <script type="text/javascript" src="../js/dialog.js"></script>
    <script type="text/javascript" src="../js/catalog-selector.js"></script>
    <script type="text/javascript">
      $(function(){
          function ajax(url, data){
              return $.ajax({
                  url: url,
                  type: 'post',
                  dataType: 'json',
                  data: $.extend({ m: Math.random() }, data)
              });
          }
          var selectorColCount = Math.floor($('.product-catalog').width() / CatalogSelector.defaultOption.colsWidth);
          var keyword = '',
              selector = window.cc = new CatalogSelector({
                  pop: false,
                  view: '#choice',
                  container: $('#selector-container'),
                  title: '选择商品类目',
                  viewTitle: '',
                  cols: selectorColCount,
                  colsHeight: 400,
                  provider: function(parentObj,callback){
                      ajax('http://123.59.58.104/supplier/product/add/ajax_get_category_list',{
                          category_id: parentObj ? parentObj.catId : 0,
                          m: Math.random()
                      }).done(function(result){
                          callback(result);
                      }).error(function(msg){
                          //debugger;
                          alert('初始化错误，请联系管理员');
                      })
                  },
                  adapter: function(data){
                      return {
                          hasChild: true,
                          text: data.catName
                      };
                  }
              });
          $('#selector').width(selectorColCount * CatalogSelector.defaultOption.colsWidth + 22);
      
          $('#btn-search').click(function(){
              keyword = $.trim($('#input-groom').val());
              //selector.reset();
              //搜索所有符合的类目
              searchCata(keyword)
          });
          /* 暂时不使用。
          $('#input-groom').keyup(function(e){
              if((e.keyCode || e.charCode) == 13){
                  $('#btn-search').click();
                  return false;
              }
          });
          */
      
          $('form').bind('submit',function(){
              return false;
          });
      
          $('#btn-doNext').click(function(){
              if($($('.selectorBar .active:last')).parent().is('.selector-col:last')){
                  console.log(selector.getValue());
              }else{
                  alert('请正确选择叶子类目');
                  return;
              }
      
          });
      
          function searchCata(name,callback){
              //url supplier
              $.ajax({
                  method: "POST",
                  dataType:'json',
                  url:"http://123.59.58.104/supplier/product/add/search_category_by_name",
                  data:{cat_name:name}
              }).success(function(data){
                  var dataLength = data.length;
                  for(var i = 0;i < dataLength;i++){
                      var cataD = fid(data[i],[]);
                      var level = cataD.length;
                      var dataHtml = ""
                      for(var j = level ; j>1 ;j--){
                          dataHtml +=cataD[j-1].text+'<i> >> </i>';
                      }
                      dataHtml += cataD[0].text
                      dataHtml = '<li class="seachData" data="'+i+'">'+dataHtml+'</li>';
                      $("#searchChoice").append(dataHtml);
                  }
                  $('#searchChoice').on('click','.seachData',function(){
                      var dID = $(this).attr('data');
                      window.cc.setData(data[dID]);
                      //var clickData = fid(data[dID],[]);
                      //;
      
                  })
              }).error(function(data){
                  //debugger
                  alert('网络错误或者错误的请求，请联系管理员');
              })
          };
          function fid(data,cataData){
              if(data && data.level>0){
                  var isch = data.parentCat ? true:false;
                  var tm =[{text:data.catName,hasChild:isch,parentId:data.parentId}]
                  cataData = $.merge(cataData,tm)
                  return fid(data.parentCat,cataData)
              }else{
                  return cataData;
              }
          }
          function fidcataData(data){
              if(data){
                  ajax('http://123.59.58.104/supplier/product/add/ajax_get_category_list',{
                      category_id: data.parentId ? data.parentId : 0,
                      m: Math.random()
                  }).done(function(result){
                      window.cc.addColumn(result);
                      fidcataData(data.parentCat)
                  })
              }else{return false;}
              /*
              window.cc.option.provider:function(parentObj,callback){
                  ajax('http://123.59.58.104/supplier/product/add/ajax_get_category_list',{
                      category_id: parentObj ? parentObj.catId : 0,
                      m: Math.random()
                  }).done(function(result){
                      callback(result);
                  }).error(function(msg){
                      //debugger;
                      alert('初始化错误，请联系管理员');
                  })
              }
              */
          }
      });
    </script>
  </body>
</html>